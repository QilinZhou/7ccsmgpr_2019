<!DOCTYPE html>
<html>
<head>
    <title>AWS S3 File Upload</title>
	<script src="https://sdk.amazonaws.com/js/aws-sdk-2.395.0.min.js"></script> 
    <script src="index.js"></script>    
</head>
<body>
    <input id="selectfile" type="file"/>
	<button id="fileupload">Upload</button>
	<p id="results"><p></p>
    <br>
	<button id="download-button">Download</button>
	<br>
	<button id="delete-button">Delete</button>
	
	
    <script type="text/javascript">
		/// Load the SDK for JavaScript
       // var AWS = require('aws-sdk');
        //login aws by using credentials to upload
        AWS.config.update({
            accessKeyId: 'xxx',//use individual accessKeyId
			secretAccessKey: 'xxxx'//use individual secretAccessKey
        });
        //set region
        AWS.config.region = 'us-east-2'; 
		// create bucket instance
        
     /* $("#downloadButton").click(function(){
        var s3 = new AWS.S3();
        s3.getObject(
            { Bucket: "deadlinefighters", Key: "card.jpg" },
        function (error, data) {
        if (error != null) {
        alert("Failed to retrieve an object: " + error);
         } else {
        alert("Loaded " + data.ContentLength + " bytes");
        // do something with data.Body
    }
  }
);       }*/
        
      
       var bucket = new AWS.S3({params: {Bucket: 'deadlinefighters'}});  //select which bucket to upload
		var selectFile = document.getElementById('selectfile');
		var upload = document.getElementById('fileupload');
		var download = document.getElementById('download-button');
		var del = document.getElementById('delete-button');
		var results = document.getElementById('results');
        upload.addEventListener('click', function () {
			var file = selectFile.files[0];
			if (file) {
				results.innerHTML = '';
				var path = {Key: file.name, ContentType: file.type, Body: file, 'Access-Control-Allow-Credentials': '*','ACL': 'public-read'}; //set the related path of bucket, set body as file, ACL as public
				bucket.upload(path, function (err, data) {
					console.log(err);  //print error if failed
					results.innerHTML = err ? 'ERROR!' : 'The file is uploaded.';
				});
			} else {
				results.innerHTML = 'Please select a file.';
			}
		}, false);

		
		
//download		
var fs = require('fs');		
var FilePath1 = '/test.docx';
var bucket1 = 'deadlinefighters';
var key1 = 'test.docx';
var down_load = new AWS.S3();
		
//		var s3 = new AWS.S3({params1: {Bucket: 'deadlinefighters', Key: 'aws.png'}});
		download.addEventListener('click', function(){	
//			s3.getObject(
//    function (error, data) {
//    if (error != null) {
//      alert("Failed to retrieve an object: " + error);
//    } else {
//      alert("Loaded " + data.ContentLength + " bytes");
//      // do something with data.Body
//    }
//  }
//);		
	var downloadFile = (FilePath1, bucket1, key1) => {
    var params1 = {
        Bucket: bucket1,
        Key: key1
    };
		down_load.getObject(params1, (err, data) => {
        if (err) console.error(err)
        fs.writeFileSync(FilePath1, data.Body.toString())
    })
}
downloadFile(FilePath1, bucket1, key1);		
		});
		

		
		
//delete - only can delete local file now!!!
var FilePath2 = '/123.txt';
var bucket2 = 'deadlinefighters';
var key2 = '123.txt';
var dele_te = new AWS.S3();
del.addEventListener('click', function(){
	
//	fs.unlink(FilePath2,function (err) {
//    if(err){
//        return console.log(err);
//    }else {
//        console.log("delete sucessfully");
//    }
//})
	
	var deleteFile = (FilePath2, bucket2, key2) => {
	var params2 = {
		Bucket: bucket2,
		Key: key2
	};
	dele_te.getObject(params2, (err, data) => {
        	fs.unlink(FilePath2,function (err) {
    if(err){
        return console.log(err);
    }else {
        console.log("delete sucessfully");
    }
})
    })			
}
deleteFile(FilePath2, bucket2, key2);		
});		
		
		
		
		
        
    </script>
</body>
</html>
